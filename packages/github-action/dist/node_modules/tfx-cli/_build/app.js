"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const command = require("./lib/command");
const common = require("./lib/common");
const errHandler = require("./lib/errorhandler");
const loader = require("./lib/loader");
function patchPromisify() {
    // Monkey-patch promisify if we are NodeJS <8.0 or Chakra
    const nodeVersion = process.version.substr(1);
    // Chakra has a compatibility bug that causes promisify to not work.
    // See https://github.com/nodejs/node-chakracore/issues/395
    const jsEngine = process["jsEngine"] || "v8";
    const isChakra = jsEngine.indexOf("chakra") >= 0;
    if (isChakra) {
        require("util").promisify = undefined;
    }
    if (parseInt(nodeVersion.charAt(0)) < 8 || isChakra) {
        require("util.promisify/shim")();
    }
}
// Set app root
common.APP_ROOT = __dirname;
var Bootstrap;
(function (Bootstrap) {
    async function begin() {
        const cmd = await command.getCommand();
        common.EXEC_PATH = cmd.execPath;
        const tfCommand = await loader.load(cmd.execPath, cmd.args);
        await tfCommand.showBanner();
        const executor = await tfCommand.ensureInitialized();
        return executor(cmd);
    }
    Bootstrap.begin = begin;
})(Bootstrap || (Bootstrap = {}));
patchPromisify();
Bootstrap.begin()
    .then(() => { })
    .catch(reason => {
    errHandler.errLog(reason);
});
//# sourceMappingURL=app.js.map